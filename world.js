const BLOCK_SIZE = 48;

class World {
    constructor(Texturepack) {
        this.debugName = "World";

        this.isLoaded = false;

        this.Texturepack = Texturepack;

        this.Texturepack.load();
        this.textures = Texturepack.textures;

        this.offsetX = 0;
        this.offsetY = 0;

        // Old map with Id system, which we kinda hate a lil bit, so it is not in use anymore...
        // this.mapData = [
        //     // 1  2  3  4  5  6  7  8  9  10
        //     [2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
        //     [2, 2, 2, 2, 0, 2, 2, 2, 2, 2],
        //     [2, 2, 2, 2, 0, 2, 2, 2, 2, 2],
        //     [2, 2, 2, 2, 0, 2, 2, 2, 2, 2],
        //     [2, 2, 2, 2, 0, 2, 2, 2, 2, 2],
        //     [2, 2, 2, 2, 0, 2, 2, 2, 2, 2],
        //     [2, 2, 2, 2, 0, 2, 2, 2, 2, 2],
        //     [2, 2, 2, 2, 0, 2, 2, 2, 2, 2],
        //     [2, 2, 2, 2, 0, 2, 2, 2, 2, 2],
        //     [2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
        // ];

        //The test map with word ids..
        this.mapData = [
            [
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "",
                "",
                "Dirt",
                "Dirt",
                "Stone",
                "Stone",
                "Sand",
                "Sand",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "",
                "",
                "Dirt",
                "Dirt",
                "Stone",
                "Stone",
                "Sand",
                "Sand",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Sand",
                "Sand",
                "Sand",
                "Sand",
                "Sand",
                "Sand",
                "Sand",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Sand",
                "Sand",
                "Sand",
                "Sand",
                "Sand",
                "Sand",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Sand",
                "Sand",
                "Sand",
                "Sand",
                "Sand",
                "Sand",
                "Sand",
                "Sand",
                "Sand",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Grass",
                "Bedrock",
            ],
            [
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
                "Bedrock",
            ],
        ];
    }

    renderMap() {
        let mapRow,
            imgName,
            currentTile,
            newRow = [];

        this.map = []; // Creating a empty final map
        for (var i = 0; i < this.mapData.length; i++) {
            mapRow = this.mapData[i]; //assigning the current row
            for (var j = 0; j < mapRow.length; j++) {
                imgName = mapRow[j] + "_texture"; // Assembling current texture name

                // Checking if the texture actually exists
                if (imgName in this.textures) {
                    currentTile = this.textures[imgName];
                } else {
                    currentTile = this.Texturepack.undefinedTexture; // Assignning the undefined texture if needed
                }

                newRow.push(new Block(currentTile, [j, i], BLOCK_SIZE)); //Pushing newly created block in the current row
            }

            this.map.push(newRow); // Deplyoing the current row after adding all the blocks to it.
            newRow = []; // Clearing the variable thereafter :)
        }

        this.isLoaded = true; // Flagginf that the world is loaded.
    }

    Draw() {
        let currentBlock;

        for (var i = 0; i < this.mapData.length; i++) {
            for (var j = 0; j < this.mapData[i].length; j++) {
                currentBlock = this.map[i][j]; // assigning current block
                currentBlock.Draw(
                    //calculating the position where the block should be displayed, subtracting the offsets
                    j * currentBlock.size - this.offsetX,
                    i * currentBlock.size - this.offsetY
                );
            }
        }
    }

    checkCollisions() {
        let mapRow, blockX, blockY, currentBlock;

        for (var i = 0; i < this.mapData.length; i++) {
            mapRow = this.mapData[i];
            for (var j = 0; j < mapRow.length; j++) {
                currentBlock = this.mapData[i][j];

                blockX = j * BLOCK_SIZE - this.offsetX;
                blockY = i * BLOCK_SIZE - this.offsetY;

                if (
                    player.xx < blockX + BLOCK_SIZE &&
                    player.xx + player.ww > blockX &&
                    player.yy < blockY + BLOCK_SIZE &&
                    player.yy + player.hh > blockY
                ) {
                    if (currentBlock == "Stone" || currentBlock == "Bedrock") {
                        player.state = "IdleState";
                        player.xx = player.xx + 10 * (player.directionX * -1);
                        player.yy = player.yy + 10 * (player.directionY * -1);
                    }
                }
            }
        }
    }

    renderWindow() {
        const PADDING_RANGE = BLOCK_SIZE;
        const OFFSET_UPDATE = 6.4;

        if (player.xx > CANVAS_SIZE_W - PADDING_RANGE - player.ww) {
            this.offsetX += OFFSET_UPDATE;
            player.xx = CANVAS_SIZE_W - PADDING_RANGE - player.ww;
        }
        if (player.xx < PADDING_RANGE) {
            this.offsetX -= OFFSET_UPDATE;
            player.xx = PADDING_RANGE;
        }
        if (player.yy > CANVAS_SIZE_H - PADDING_RANGE - player.hh) {
            this.offsetY += OFFSET_UPDATE;
            player.yy = CANVAS_SIZE_H - PADDING_RANGE - player.hh;
        }
        if (player.yy < PADDING_RANGE) {
            this.offsetY -= OFFSET_UPDATE;
            player.yy = PADDING_RANGE;
        }
        if (this.offsetX < 0) {
            this.offsetX = 0;
        }
        if (this.offsetY < 0) {
            this.offsetY = 0;
        }
    }
}
